$(".numtransform").change(function(){
	var num=parseFloat($(this).val());
	var rate=parseFloat($(this).next().val());
	//console.log($(this).val());
	if(isNaN(num)||isNaN(num/rate)){
		$(this).prev().val("");
		//console.log($(this).prev().val());
		return ;
	}
	$(this).prev().val((num/rate).toFixed(15));
	//$(this).prev().val((num/rate));
	//console.log($(this).prev().val());
});
$(".unit").change(function(){
	var num=parseFloat($(this).prev().val());
	var rate=parseFloat($(this).val());
	if(isNaN(num)){
		$(this).prev().prev().val("");
		return ;
	}
	//console.log("num:"+num+";rate:"+rate);
	$(this).prev().prev().val(num/rate);
	//console.log($(this).prev().prev().val());
});




// JavaScript Document
// 单位分类数据
var category=["速度","长度","重量","功率"];
// 每个分类的具体单位数据
var category_units =[
        ["节","米/分","米/秒","千米/小时","英里/分","英里/小时"],
        ["尺","寸","分","分米","海里","毫米","厘米","里","码","米","纳米","千米","丝米","微米","英尺","英寸","英里","丈"],
        ["盎司","磅","打兰","短吨","吨","格令","公担","克","夸特","千克","英担","英石"],
        ["瓦","千瓦","英制马力","米制马力","公斤·米/秒","千卡/秒","英热单位/秒","英尺·磅/秒"]
        ];
//单位转换数组
var unit_convert = [
                    [
                        [1.0000000000 ,30.8666700000 ,0.5144440000 ,1.8520000000 ,0.0191800000 ,1.1507790000 ],
                        [0.0323970000 ,1.0000000000 ,0.0166670000 ,0.0600000000 ,0.0006210000 ,0.0372820000 ],
                        [1.9438440000 ,60.0000000000 ,1.0000000000 ,3.6000000000 ,0.0373820000 ,2.2369360000 ],
                        [0.5399570000 ,16.6666670000 ,0.2777780000 ,1.0000000000 ,0.0103560000 ,0.6213710000 ],
                        [52.1385750000 ,1609.3440000000 ,26.8224000000 ,96.5606400000 ,1.0000000000 ,60.0000000000 ],
                        [0.8689760000 ,26.8224000000 ,0.4470400000 ,1.6093440000 ,0.0166670000 ,1.0000000000 ]
                    ],
                    [
                        [1.0000000000 ,10.0000000000 ,100.0000000000 ,3.3333330000 ,0.0001800000 ,333.3333330000 ,33.3333330000 ,3.7040000000 ,0.3645380000 ,3.3333330000 ,333333333.3333330000 ,333333333.3333330000 ,3333.3333330000 ,333333.3333330000 ,1.0936130000 ,13.1233600000 ,0.0020700000 ,0.1000000000],
                        [0.1000000000 ,1.0000000000 ,10.0000000000 ,0.3333330000 ,0.0000180000 ,33.3333330000 ,3.3333330000 ,0.0000670000 ,0.0364540000 ,0.0333330000 ,33333333.3333330000 ,0.0033330000 ,333.3333330000 ,33333.3333330000 ,1.0936130000 ,1.3123360000 ,0.0000210000 ,0.0100000000],
                        [0.0100000000 ,0.1000000000 ,1.0000000000 ,0.0333330000 ,0.0000020000 ,3.3333330000 ,0.3333330000 ,0.0000070000 ,0.0036450000 ,0.0033330000 ,3333333.3333330000 ,0.0000030000 ,33.3333330000 ,3333.3333330000 ,0.0109360000 ,0.1312340000 ,0.0000020000 ,0.0010000000 ],
                        [0.3000000000 ,3.0000000000 ,30.0000000000 ,1.0000000000 ,0.0000540000 ,100.0000000000 ,10.0000000000 ,0.0002000000 ,0.1093610000 ,0.1000000000 ,100000000.0000000000 ,0.0001000000 ,1000.0000000000 ,100000.0000000000 ,0.3280840000 ,0.1312340000 ,0.0000620000 ,0.0300000000], 
                        [5556.0000000000 ,55560.0000000000 ,555600.0000000000 ,18520.0000000000 ,1.0000000000 ,1852000.0000000000 ,185200.0000000000 ,3.7040000000 ,2025.3712760000 ,1852.0000000000 ,1609340000000.0000000000 ,1.8520000000 ,18520000.0000000000 ,1852000000.0000000000 ,6076.1156800000 ,72913.3863080000 ,1.1500920000 ,555.6000000000], 
                        [0.0030000000 ,0.0300000000 ,0.3000000000 ,0.0100000000 ,0.0000005400 ,1.0000000000 ,0.1000000000 ,0.0000020000 ,0.0010940000 ,0.0010000000 ,1000000.0000000000 ,0.0000010000 ,10.0000000000 ,1000.0000000000 ,0.0032810000 ,0.0393700000 ,0.0000006210 ,0.0003000000 ],
                        [0.0300000000 ,0.3000000000 ,3.0000000000 ,0.1000000000 ,0.0000050000 ,10.0000000000 ,1.0000000000 ,0.0000200000 ,0.0109360000 ,0.0100000000 ,10000000.0000000000 ,0.0000100000 ,100.0000000000 ,10000.0000000000 ,0.0328080000 ,0.3937010000 ,0.0000060000 ,0.0030000000], 
                        [1500.0000000000 ,15000.0000000000 ,150000.0000000000 ,5000.0000000000 ,0.2700000000 ,500000.0000000000 ,50000.0000000000 ,1.0000000000 ,546.8065000000 ,500.0000000000 ,500000000000.0000000000 ,0.5000000000 ,5000000.0000000000 ,500000000.0000000000 ,1640.4200000000 ,19685.0395000000 ,0.3105000000 ,150.0000000000], 
                        [2.7432000000 ,27.4320000000 ,274.3200000000 ,9.1440000000 ,0.0004940000 ,914.4000000000 ,91.4400000000 ,0.0018290000 ,1.0000000000 ,0.9144000000 ,914400000.0000000000 ,0.0009140000 ,9144.0000000000 ,914400.0000000000 ,3.0000000000 ,36.0000000000 ,0.0005680000 ,0.2743200000 ],
                        
                        [0.0000000030 ,0.0000000300 ,0.0000003000 ,0.0000000100 ,0.0000000000 ,0.0000010000 ,0.0000001000 ,0.0000000000 ,0.0000000011 ,0.0000000010 ,1.0000000000 ,0.0000000000 ,0.0000100000 ,0.0010000000 ,0.0000000033 ,0.0000000394 ,0.0000000000 ,0.0000000003 ],
                        [3000.0000000000 ,30000.0000000000 ,300000.0000000000 ,10000.0000000000 ,0.5400000000 ,1000000.0000000000 ,100000.0000000000 ,2.0000000000 ,1093.6130000000 ,1000.0000000000 ,1000000000000.0000000000 ,1.0000000000 ,10000000.0000000000 ,1000000000.0000000000 ,3280.8400000000 ,39370.0790000000 ,0.6210000000 ,300.0000000000 ],
                        [0.0003000000 ,0.0030000000 ,0.0300000000 ,0.0010000000 ,0.0000000540 ,0.1000000000 ,0.0100000000 ,0.0000002000 ,0.0001090000 ,0.0001000000 ,100000.0000000000 ,0.0000001000 ,1.0000000000 ,100.0000000000 ,0.0003280000 ,0.0039370000 ,0.0000000621 ,0.0000300000 ],
                        [0.0000030000 ,0.0000300000 ,0.0003000000 ,0.0000100000 ,0.0000000005 ,0.0010000000 ,0.0001000000 ,0.0000000020 ,0.0000010000 ,0.0000010000 ,1000.0000000000 ,0.0000000010 ,0.0100000000 ,1.0000000000 ,0.0000030000 ,0.0000390000 ,0.0000000006 ,0.0000003000 ],
                        [0.9144000000 ,9.1440000000 ,91.4400000000 ,3.0480000000 ,0.0001650000 ,304.8000000000 ,30.4800000000 ,0.0006100000 ,0.3333330000 ,0.3048000000 ,304800000.0000000000 ,0.0003050000 ,3048.0000000000 ,304800.0000000000 ,1.0000000000 ,12.0000000000 ,0.0001890000 ,0.0914400000 ],
                        [0.0762000000 ,0.7620000000 ,7.6200000000 ,0.2540000000 ,0.0000140000 ,25.4000000000 ,2.5400000000 ,0.0000000020 ,0.0277780000 ,0.0254000000 ,25400000.0000000000 ,0.0000250000 ,254.0000000000 ,25400.0000000000 ,0.0833330000 ,1.0000000000 ,0.0000160000 ,0.0076200000 ],
                        [4828.0200000000 ,48280.2000000000 ,482802.0000000000 ,16093.4000000000 ,0.8690440000 ,1609340.0000000000 ,160934.0000000000 ,3.2186800000 ,1759.9951450000 ,1609.3400000000 ,1609340000000.0000000000 ,1.6093400000 ,16093400.0000000000 ,1609340000.0000000000 ,5279.9870460000 ,63359.8429380000 ,1.0000000000 ,482.8020000000], 
                        [10.0000000000 ,100.0000000000 ,1000.0000000000 ,33.3333330000 ,0.0018000000 ,3333.3333330000 ,333.3333330000 ,0.0066670000 ,3.6453770000 ,3.3333330000 ,3333333333.3333300000 ,0.0033330000 ,33333.3333330000 ,3333333.3333330000 ,10.9361330000 ,131.2335970000 ,0.0020700000 ,1.0000000000 ]
                    ],
                    [
                        [1.0000000000 ,0.0625010000 ,15.9988710000 ,0.0000310000 ,0.0000280000 ,436.1538460000 ,0.0002840000 ,43.9534880000 ,0.0022320000 ,0.0283500000 ,0.0005580000 ,0.0044640000 ],
                        [15.9997180000 ,1.0000000000 ,255.9774270000 ,0.0005000000 ,0.0004540000 ,6978.3384620000 ,0.0045360000 ,703.2434110000 ,0.0357160000 ,0.4535920000 ,0.0089290000 ,0.0714280000 ],
                        [0.0625040000 ,0.0039070000 ,1.0000000000 ,0.0000020000 ,0.0000020000 ,27.2615380000 ,0.0000180000 ,2.7472870000 ,0.0001400000 ,0.0017720000 ,0.0000350000 ,0.0002790000 ],
                        [31999.4620850000 ,2000.0012500000 ,511955.2710810000 ,1.0000000000 ,0.9071850000 ,13956688.3080410000 ,9.0718470000 ,1406487.9690840000 ,71.4317260000 ,907.1847400000 ,17.8579320000 ,142.8571030000 ],
                        [35273.3690000000 ,2204.6240000000 ,564334.0860000000 ,1.1020000000 ,1.0000000000 ,15384615.3850000000 ,10.0000000000 ,1550387.5970000000 ,78.7400000000 ,1000.0000000000 ,19.6850000000 ,157.4730000000 ],
                        [0.0022930000 ,0.0001430000 ,0.0366820000 ,0.0000000716 ,0.0000000650 ,1.0000000000 ,0.0000006500 ,0.1007750000 ,0.0000050000 ,0.0000650000 ,0.0000010000 ,0.0000100000 ],
                        [3527.3369000000 ,220.4624000000 ,56433.4086000000 ,0.1102000000 ,0.1000000000 ,1538461.5385000000 ,1.0000000000 ,155038.7597000000 ,7.8740000000 ,100.0000000000 ,1.9685000000 ,15.7473000000 ],
                        [0.0227510000 ,0.0014220000 ,0.3639950000 ,0.0000007108 ,0.0000006450 ,9.9230770000 ,0.0000006500 ,1.0000000000 ,0.0000510000 ,0.0006450000 ,0.0000130000 ,0.0001020000 ],
                        [447.9717860000 ,27.9987250000 ,7167.0428920000 ,0.0139950000 ,0.0127000000 ,195384.6153890000 ,0.1270000000 ,19689.9224820000 ,1.0000000000 ,12.7000000000 ,0.2500000000 ,1.9999070000 ],
                        [35.2733690000 ,2.2046240000 ,564.3340860000 ,0.0011020000 ,0.0010000000 ,15384.6153850000 ,0.0100000000 ,1550.3875970000 ,0.0787400000 ,1.0000000000 ,0.0196850000 ,0.1574730000 ],
                        [35.2733690000 ,111.9948990000 ,28668.1715689999 ,0.0559820000 ,0.0508000000 ,781538.4615580000 ,0.5080000000 ,78759.6899280000 ,3.9999920000 ,50.8000000000 ,1.0000000000 ,7.9996280000 ],
                        [223.9961220000 ,14.0000020000 ,3583.6851030000 ,0.0069980000 ,0.0063500000 ,97696.7692330000 ,0.0635030000 ,9845.4108530000 ,0.5000220000 ,6.3502900000 ,0.1250050000 ,1.0000000000 ]
                    ],
                    [
                        [1.0000,0.001,0.001341,0013596,0.1019716,0.000239,0.0009478,0.7375621],
                        [1000.00000,1.00000,1.3410221,1.3596216,101.9716213,0.239,0.9478171,737.5621489],
                        [745.699872,0.7456999,1.000,1.0138697,76.0402249,0.1782223,0.7067871,550.000],
                        [735.49875,0.7354987,0.9863201,1.00000,75.000,0.1757842,0.6971183,542.4760385],
                        [9.80665,0.0098067,0.0131509,0.0133333,1.00000,0.0023438,0.0092949,7.2330138],
                        [4184.1004,4.1841004,5.6109711,5.6887934,426.6595015,1.000000,3.965762,3086.0340821],
                        [1055.05585,1.0550559,1.4148532,1.4344767,107.5857556,0.2521583,1.0000,778.1692599],
                        [1.3558179,0.0013558,0.0018182,0.0018434,0.138255,0.000324,0.0012851,1.000000]
                    ]
                    
];
// JavaScript Document
//初始下拉框
function unitSelecdtInit(obj_1,obj_2,obj_3,convertButton,inputText,outputText){
    var cindex = 0;
    var aindex = 0;
    var bindex = 0;
    //初始分类下拉框
    for(var i=0;i<category.length;i++){
             $("<option value='"+i+"'>"+category[i]+"</option>").appendTo($("#"+obj_1));
    }
    //初始A、B下拉框
    for(var i=0;i<category_units[cindex].length;i++){
             $("<option value='"+i+"'>"+category_units[cindex][i]+"</option>").appendTo($("#"+obj_2));
              $("<option value='"+i+"'>"+category_units[cindex][i]+"</option>").appendTo($("#"+obj_3));
    }
    //绑定change事件
    $("#"+obj_1).change(function(){
        cindex=$(this).val();
        $("#"+obj_2).empty();
        $("#"+obj_3).empty();
        for(var i=0;i<category_units[cindex].length;i++){
             $("<option value='"+i+"'>"+category_units[cindex][i]+"</option>").appendTo($("#"+obj_2));
              $("<option value='"+i+"'>"+category_units[cindex][i]+"</option>").appendTo($("#"+obj_3));
       }
    });
    $("#"+obj_2).change(function(){
        aindex=$(this).val();
    });
    $("#"+obj_3).change(function(){
        bindex=$(this).val();
    });
    $("#"+convertButton).click(function(){
        $("#"+outputText).val($("#"+inputText).val()*unit_convert[cindex][aindex][bindex]);
    });
};
var i=2;
//$("#covert").fadeOut();
$("#coverttoggle").click(function(){
	if(i===1){
		$(this).val("单位转换展开");
		i=2;
	}
	else{
		$(this).val("单位转换折叠");
		i=1;
	}
	$("#covert").fadeToggle(500);
})

$().ready(function(){
    unitSelecdtInit('cselect','aselect','bselect','convert','atextfield','btextfield');
});